<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>PDS-32 - Smart Energy Management</title>
    <!-- Link external CSS -->
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='css/style.css') }}"
    />
  </head>
  <body>
    <div class="container">
      <!-- ==================== HEADER ==================== -->
      <header>
        <h1>
          <span>‚ö°</span>
          PDS-32 - Gestion √ânerg√©tique Intelligente
          <span>‚ö°</span>
        </h1>
        <p>Monitoring & Optimisation en Temps R√©el</p>
        <div class="header-meta">
          <div class="live-indicator" id="deviceStatusContainer">
            <span class="pulse-dot" id="statusDot"></span>
            <span id="statusText">Chargement...</span>
          </div>
          <div class="last-seen" id="lastSeenDisplay">
            Derni√®re activit√©: --:--
          </div>
          <div class="timestamp" id="lastUpdate">Chargement...</div>
        </div>
      </header>

      <!-- ==================== METRICS GRID ==================== -->
      <div class="grid">
        <!-- Consommation Actuelle -->
        <div class="card">
          <h2><span class="card-icon">‚ö°</span> Consommation Actuelle</h2>
          <div class="metric">
            <span class="metric-label">Puissance</span>
            <span class="metric-value" id="currentPower"
              >--<span class="metric-unit">W</span></span
            >
          </div>
          <div class="metric">
            <span class="metric-label">Courant</span>
            <span class="metric-value" id="currentCurrent"
              >--<span class="metric-unit">A</span></span
            >
          </div>
          <div class="metric">
            <span class="metric-label">√ânergie Totale</span>
            <span class="metric-value" id="totalEnergy"
              >--<span class="metric-unit">kWh</span></span
            >
          </div>
          <div class="metric">
            <span class="metric-label">Co√ªt Actuel</span>
            <span class="metric-value" id="currentCost"
              >--<span class="metric-unit">TND</span></span
            >
          </div>
        </div>

        <!-- Capteurs Environnementaux -->
        <div class="card">
          <h2><span class="card-icon">üå°Ô∏è</span> Environnement</h2>
          <div class="metric">
            <span class="metric-label">Temp√©rature</span>
            <span class="metric-value" id="temperature"
              >--<span class="metric-unit">¬∞C</span></span
            >
          </div>
          <div class="metric">
            <span class="metric-label">Humidit√©</span>
            <span class="metric-value" id="humidity"
              >--<span class="metric-unit">%</span></span
            >
          </div>
          <div class="metric">
            <span class="metric-label">Luminosit√©</span>
            <span class="metric-value" id="lightLevel"
              >--<span class="metric-unit">%</span></span
            >
          </div>
          <div class="metric">
            <span class="metric-label">Pr√©sence</span>
            <span class="metric-value">
              <span class="status-indicator" id="presenceIndicator"></span>
              <span id="presenceText" style="font-size: 0.8em">--</span>
            </span>
          </div>
        </div>

        <!-- Contr√¥le des Actionneurs -->
        <div class="card">
          <h2><span class="card-icon">üîå</span> Contr√¥le √âquipements</h2>
          <!-- Relay 1: HVAC -->
          <div style="margin-bottom: 20px">
            <div class="metric">
              <span class="metric-label">Climatisation / Chauffage</span>
              <span>
                <span class="status-indicator" id="relay1Indicator"></span>
                <span id="relay1Status">--</span>
              </span>
            </div>
            <div class="button-group">
              <button class="btn-on" onclick="controlRelay('relay1_on')">
                ON
              </button>
              <button class="btn-off" onclick="controlRelay('relay1_off')">
                OFF
              </button>
            </div>
          </div>
          <!-- Relay 2: Lumi√®res -->
          <div style="margin-bottom: 20px">
            <div class="metric">
              <span class="metric-label">√âclairage</span>
              <span>
                <span class="status-indicator" id="relay2Indicator"></span>
                <span id="relay2Status">--</span>
              </span>
            </div>
            <div class="button-group">
              <button class="btn-on" onclick="controlRelay('relay2_on')">
                ON
              </button>
              <button class="btn-off" onclick="controlRelay('relay2_off')">
                OFF
              </button>
            </div>
          </div>
          <!-- NOUVEAU: Fen√™tre -->
          <div style="margin-bottom: 20px">
            <div class="metric">
              <span class="metric-label">ü™ü Fen√™tre</span>
              <span>
                <span class="status-indicator" id="windowIndicator"></span>
                <span id="windowStatus">--</span>
              </span>
            </div>
            <div class="button-group">
              <button class="btn-on" onclick="controlRelay('window_open')">
                OUVRIR
              </button>
              <button class="btn-off" onclick="controlRelay('window_close')">
                FERMER
              </button>
            </div>
          </div>
          <!-- Mode Auto -->
          <div>
            <div class="metric">
              <span class="metric-label">Mode Automatique</span>
              <span id="autoModeStatus">--</span>
            </div>
            <div class="button-group">
              <button class="btn-auto" onclick="controlRelay('auto_on')">
                ACTIVER AUTO
              </button>
              <button class="btn-off" onclick="controlRelay('auto_off')">
                D√âSACTIVER AUTO
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- ==================== ANALYTICS ==================== -->
      <div class="grid">
        <div class="card">
          <h2><span class="card-icon">üìä</span> Analyse Consommation</h2>
          <div class="metric">
            <span class="metric-label">Aujourd'hui</span>
            <span class="metric-value" id="todayEnergy"
              >--<span class="metric-unit">kWh</span></span
            >
          </div>
          <div class="metric">
            <span class="metric-label">Co√ªt Aujourd'hui</span>
            <span class="metric-value" id="todayCost"
              >--<span class="metric-unit">TND</span></span
            >
          </div>
          <div class="metric">
            <span class="metric-label">Estimation Mensuelle</span>
            <span class="metric-value" id="monthlyEstimate"
              >--<span class="metric-unit">TND</span></span
            >
          </div>
          <div class="metric">
            <span class="metric-label">√âconomies Potentielles</span>
            <span
              class="metric-value"
              style="color: #10b981"
              id="potentialSavings"
              >--<span class="metric-unit">TND</span></span
            >
          </div>
        </div>

        <div class="card">
          <h2><span class="card-icon">üìà</span> Statistiques</h2>
          <div class="metric">
            <span class="metric-label">Puissance Moyenne</span>
            <span class="metric-value" id="avgPower"
              >--<span class="metric-unit">W</span></span
            >
          </div>
          <div class="metric">
            <span class="metric-label">Pic de Consommation</span>
            <span class="metric-value" id="peakPower"
              >--<span class="metric-unit">W</span></span
            >
          </div>
          <div class="metric">
            <span class="metric-label">Heure du Pic</span>
            <span class="metric-value" style="font-size: 1em" id="peakTime"
              >--</span
            >
          </div>
          <div class="metric">
            <span class="metric-label">Comparaison Hier</span>
            <span class="metric-value" id="comparison" style="font-size: 1em"
              >--</span
            >
          </div>
        </div>
      </div>

      <!-- ==================== GRAPHIQUES ==================== -->
      <div class="chart-container">
        <h2>üìà Consommation √ânerg√©tique (24h)</h2>
        <canvas id="powerChart"></canvas>
      </div>

      <div class="chart-container">
        <h2>üå°Ô∏è Temp√©rature & Humidit√© (24h)</h2>
        <canvas id="environmentChart"></canvas>
      </div>

      <!-- ==================== ALERTES ==================== -->
      <div class="card">
        <h2><span class="card-icon">üö®</span> Alertes R√©centes</h2>
        <div id="alertsContainer">
          <div class="loading">
            <div class="spinner"></div>
            <p>Chargement des alertes...</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Chart.js Library -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <script src="{{ url_for('static', filename='js/main.js') }}"></script>
  </body>
</html>
